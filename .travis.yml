language: ruby
cache: bundler
rvm:
- 2.4.1
addons:
  postgresql: '9.6'
  sources:
  - google-chrome
  apt:
    packages:
    - google-chrome-stable
services:
- redis-server
before_script:
- psql -c 'create database travis_ci_test;' -U postgres
- cp config/database.yml.travis config/database.yml
- wget http://chromedriver.storage.googleapis.com/2.42/chromedriver_linux64.zip
- unzip chromedriver_linux64.zip
- sudo apt-get install libnss3
- sudo apt-get --only-upgrade install google-chrome-stable
- sudo cp chromedriver /usr/local/bin/.
- sudo chmod +x /usr/local/bin/chromedriver
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- sleep 3
script:
- RAILS_ENV=test bundle exec rails db:migrate --trace
- bundle exec rails db:test:prepare
- bundle exec rails test
- bundle exec rails test:system
notifications:
  slack:
    secure: n0v3/iVdKCoEKEe2w/tho42BTHTpf7Z2lpcpJqy+s6igrydmwrCIgZjx/LIeFuJfFWCZqpubIpSzGHPPNQiL3codSyxI7eVev27HpLE69bEJyHHX7eKS6838xRxdD+GlynhRT4UR9UGFsC5SP8JHgLqC48vy3w9x0F+hK2MWptguRnx7TeXTIPtU+dI8lTnjdeyvJKIS41T2ywHZ/BfbwMsAI76/NpaBvIeDe+Hk2efeE6IOgRMTqHbmbgvxDf00c6EP/QCqUthSL0OmAjcOEjRBAHHeXsn7e7lbDMhsTJmU+K+M8iUxZILzUt2EgnG5dng4xjWWeb4alb+PdIfkn3cPk0M4CMeXhXp7pWEKWr3C6aQDTQ7XiTdeapDkdEaNB2F6/Nh9gNEKtMGdfZnioq6+SqffoMNy0ieVEFp4nm36mODzAVB6QD+eW6+qnFrO+uUE587VI2yUPYW/r/+5kr6PEY1J5HL7Lq0AJY6Yi3aIvad7NQ259xFr8kx+3K0bGORBlEpu1zMWozzm1K8ImDcMtChyrSQJpgEAjsyOeqWbtznciyb/8/ZihVIbKd7tNsPoGHfedCFJjgorTcmc+HIt02J5TA91eq8zym9O89/K1toI+esy1VUA7Rgy8zh6aoKI4BG7zgUrX8Jxp1jmSVGgsy3RSKlBV7RGvyBNpys=
deploy:
  provider: heroku
  api_key:
    secure: VyWHcd1os/MqSC38zcnVAoqhsH7qb5Dos7D/sgHekT8/Ppf6+WBR7XmrDeSzLa1MrX98liFHMPAQsLCjPc94+Kdt/iOKzlKStw5RbptptmKdk65VU/Br1LCL0yF/8eAc0isE3EgZ7lPvFUTbB03BgLWXsQ6tkutFJlRFmBR078eEboAhLsU2qOdEN6W+Jh1KT4qqz4dwWYrKgCgj1laeGB8YlK9XSeXz8EHX8/Dlw5VleHBT3RWk7pkyc9UTRDXdWFzy8shbfku2DRxmrHG3lArQa02hWvEKUJnsS0ay4cS1Y9pPOQ4nEVFumcz1iSFNgg2V1dJkLbuLDiVywiPnsug0aQozgAJPQiKwd9F7oa9O2D9Cl7wyB8m3Uxb8g/NNKVT5mZ65VMPAXnHuVh9xqWIAqzI6bds98HMh0kheGFlUb/hUVmGD2/Cf2pi12wykLgf3Wt9VBO0Pg8kwSg3jwOlO2qD4wuui5q6d4WprGihDN+07IoY81ugGPaD2sbDgvwSYYCdE9tF2TK/rfALFezzxTz25Mm33YEv89vdzEILwyMvrYI5AFDYiJE2iiarnwJUkt4xvgwFyGb2W0DkLTLfqoR1L7Z/+h3oaYGY440kKafn3tu2LbpovkDfOkWcoykQJFhc03LRzThx3OfV9IOlyFsS3TDJ9vVc0KIm9iP4=
  app: florence-api
  on:
    repo: hurricane-response/florence-api
    tags: true
  run:
    - rails db:migrate
    - rake cleanup
